# IBPM実験条件の詳細

## 実行コマンド

```bash
/opt/ibpm/build/ibpm -outdir /workspace/data/ibpm_full -tecplot 1 -geom cylinder.geom -nsteps 250
```

---

## 1. 流体力学的条件

### Reynolds数
```
Re = 100
```

**物理的意味**:
- Re = (慣性力) / (粘性力)
- Re = 100 は層流から遷移領域への境界
- この条件では、円柱後方にカルマン渦列が形成される

### 無次元化パラメータ
- **特性長さ**: 円柱直径 D = 1.0
- **特性速度**: 一様流速 U∞ = 1.0
- **動粘性係数**: ν = U∞ × D / Re = 0.01

---

## 2. 幾何形状 (cylinder.geom)

### 円柱の定義
```
body Cylinder
  circle_n 0 0 0.5 160
end
```

**パラメータ**:
- **中心座標**: (x, y) = (0, 0)
- **半径**: r = 0.5 → **直径 D = 1.0**
- **境界点数**: 160点（埋め込み境界法の離散化点）

### 境界条件
- **円柱表面**: No-slip境界条件 (u = v = 0)
- **流入境界**: 一様流 u = 1.0, v = 0
- **流出境界**: 自然流出条件

---

## 3. 計算グリッド

### グリッド解像度
```
nx = 200
ny = 200
ngrid = 1 (single domain)
```

**実際の格子点数**:
- Tecplotファイルに記録されている点数: **199 × 199**
- これは、200個の格子セル → 199個のグリッド点（セル中心）を意味する

### 計算領域
```
x方向: -2.0 ≤ x ≤ 2.0  (length = 4.0)
y方向: -2.0 ≤ y ≤ 2.0  (length = 4.0)
```

**グリッド間隔**:
```
Δx = Δy = 4.0 / 200 = 0.02
```

### 円柱の位置
- 円柱中心: (0, 0)
- 計算領域の中央に配置
- 円柱直径 D = 1.0 に対して、領域サイズは 4D × 4D

---

## 4. 時間積分

### 時間刻み
```
dt = 0.02
```

### 時間積分スキーム
```
3rd-order Runge-Kutta (3-step)
```

**特性**:
- 3次精度の陽的Runge-Kutta法
- 安定性と精度のバランスが良い

### 総ステップ数と時間
```
nsteps = 250
総時間 = 250 × 0.02 = 5.0 (無次元時間)
```

**物理時間の解釈**:
- 無次元時間 t* = t × U∞ / D = 5.0
- 円柱を通過する流れの特性時間スケール: T = D / U∞ = 1.0
- **約5回の特性時間分のシミュレーション**

### CFL数
```
CFL = U∞ × dt / Δx = 1.0 × 0.02 / 0.02 = 1.0
```

この値は数値的安定性の境界に近いが、3次RKスキームによって安定化されています。

---

## 5. 出力設定

### Tecplot出力
```
-tecplot 1
```
- **出力頻度**: 1ステップごと
- **総ファイル数**: 251ファイル (ibpm00000.plt ~ ibpm00250.plt)
- **各ファイルサイズ**: 約2.4 MB

### 出力変数 (Tecplot)
```
VARIABLES = "x" "y" "u" "v" "Vorticity"
```

| 変数 | 意味 |
|------|------|
| x, y | 空間座標 |
| u | x方向速度成分 |
| v | y方向速度成分 |
| Vorticity | 渦度 ω = ∂v/∂x - ∂u/∂y |

### 力係数出力
```
-force 1
```
- **出力頻度**: 1ステップごと
- **出力ファイル**: `ibpm.force`
- **データ形式**: `step time Fx Fy`

---

## 6. 数値解法

### 投影法 (Projection Method)
1. **予測ステップ**: 対流・拡散項を計算
   ```
   u* = u^n + dt × [-(u·∇)u + ν∇²u]
   ```

2. **投影ステップ**: 非圧縮性条件を満たすように補正
   ```
   ∇²p = ∇·u* / dt
   u^(n+1) = u* - dt∇p
   ```

3. **埋め込み境界条件**: 円柱表面でno-slip条件を強制

### 解法アルゴリズム
- **圧力Poisson方程式**: Cholesky分解 + FFT
- **時間積分**: 3次Runge-Kutta法

---

## 7. 計算結果の統計

### 抗力係数 (X方向力)

```
初期値 (t=0.02):  Fx = 6.96251
最終値 (t=5.00):  Fx = 2.08605
平均値 (t>1.00):  Fx = 2.05878 ± 0.03467
```

**物理的解釈**:
- 初期値が大きいのは、静止状態からの急激な加速による過渡応答
- t > 1.0 で定常状態に到達
- **定常抗力係数**: Cd ≈ 2.06

### 揚力係数 (Y方向力)

```
平均値: Fy ≈ 8.21e-15 (実質的にゼロ)
標準偏差: 8.07e-15
```

**物理的解釈**:
- 揚力はほぼゼロ（数値誤差レベル）
- これは流れが左右対称（y軸に関して対称）であることを意味
- Re = 100では、渦の放出がまだ非対称になっていない可能性

### 流れの状態

**時間発展**:
1. **t = 0 ~ 1.0**: 過渡期（抗力が急速に減少）
2. **t > 1.0**: 定常または準定常状態（抗力が安定）

**Re = 100での予想される流れ**:
- 円柱後方にカルマン渦列が形成される
- 渦の放出周期: Strouhal数 St ≈ 0.16 → T ≈ 6.25
- **現在のシミュレーション時間 (t=5.0) では、渦放出の1周期に満たない**

---

## 8. 参照値との比較

### 円柱流れ (Re=100) の理論値

| パラメータ | 理論値 | 本実験 | 誤差 |
|-----------|--------|--------|------|
| 抗力係数 Cd | 1.4 ~ 1.5 | 2.06 | +40% |
| Strouhal数 St | 0.164 | N/A | - |

**抗力係数の差異の理由**:
1. **まだ定常状態に達していない**: t=5.0は短すぎる可能性
2. **計算領域の影響**: 4D×4Dの領域は小さい可能性（通常10D以上推奨）
3. **グリッド解像度**: 200×200は粗い（通常400×400以上推奨）

---

## 9. データ変換用パラメータ

### SDAへの変換設定

変換スクリプト (`/workspace/scripts/convert_ibpm_to_sda.py`) での設定:

```python
# グリッド: 199×199 (IBPM出力)
# ↓ 粗視化 (coarsen_factor=4)
# グリッド: 49×49
# ↓ 補間 (scipy.ndimage.zoom)
# グリッド: 64×64 (SDA用)
```

**変換後のデータ**:
- **空間解像度**: 64×64
- **チャンネル数**: 2 (u, v)
- **時間ステップ数**: 251
- **形式**: HDF5 (train.h5, test.h5)

---

## 10. 推奨される追加実験

### より長時間のシミュレーション

```bash
# 1000ステップ (t=20.0)
ibpm -geom cylinder.geom -nsteps 1000 -tecplot 10 -outdir /workspace/data/ibpm_long
```

**理由**:
- カルマン渦の複数周期を観測 (St≈0.16 → T≈6.25, 3周期で約20時間必要)
- 定常状態の確認

### より細かいグリッド

```bash
# 400×400グリッド
ibpm -geom cylinder.geom -nx 400 -ny 400 -nsteps 500 -tecplot 10
```

**理由**:
- 渦構造の詳細な解像
- 抗力係数の精度向上

### より大きな計算領域

```bash
# 10D×10Dの領域
ibpm -geom cylinder.geom -length 10 -xoffset -5 -yoffset -5 -nsteps 500
```

**理由**:
- 境界の影響を低減
- より正確な抗力・揚力係数

---

## 11. まとめ

### 現在の実験条件

```
流体条件:
  - Reynolds数: Re = 100
  - 円柱直径: D = 1.0
  - 一様流速: U∞ = 1.0

グリッド:
  - 解像度: 200×200 (実質199×199点)
  - 領域: 4.0 × 4.0 (4D × 4D)
  - 格子間隔: Δx = Δy = 0.02

時間積分:
  - 時間刻み: dt = 0.02
  - 総ステップ数: 250
  - 総時間: t = 5.0 (無次元)
  - スキーム: 3次Runge-Kutta

出力:
  - Tecplotファイル: 251個 (1ステップごと)
  - 力係数: ibpm.force (1ステップごと)
  - 変数: x, y, u, v, vorticity
```

### 結果の特徴

- **抗力係数**: Cd ≈ 2.06 (定常値)
- **揚力係数**: Cl ≈ 0 (対称流)
- **流れの状態**: 過渡期から定常へ移行中
- **データサイズ**: 251タイムステップ × 199×199グリッド

この条件は、SDAフレームワークでの機械学習実験の初期検証には適していますが、より詳細な流体力学的解析には、より長時間・高解像度のシミュレーションが推奨されます。
